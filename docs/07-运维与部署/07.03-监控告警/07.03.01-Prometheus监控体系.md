# 07.03.01 Prometheus监控体系

## 目录

- [07.03.01 Prometheus监控体系](#070301-prometheus监控体系)
  - [目录](#目录)
  - [1. 概述](#1-概述)
  - [2. Prometheus部署](#2-prometheus部署)
    - [2.1 Docker部署](#21-docker部署)
    - [2.2 Kubernetes部署](#22-kubernetes部署)
  - [3. Redis Exporter配置](#3-redis-exporter配置)
    - [3.1 Exporter部署](#31-exporter部署)
    - [3.2 Prometheus配置](#32-prometheus配置)
  - [4. 监控指标采集](#4-监控指标采集)
    - [4.1 关键指标](#41-关键指标)
  - [5. 告警规则配置](#5-告警规则配置)
    - [5.1 告警规则](#51-告警规则)
  - [6. 扩展阅读](#6-扩展阅读)
  - [7. 权威参考](#7-权威参考)

---

## 1. 概述

Prometheus监控体系涵盖Prometheus部署、Redis Exporter配置、监控指标采集和告警规则配置。

---

## 2. Prometheus部署

### 2.1 Docker部署

```yaml
# docker-compose.yml
version: '3'
services:
  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus-data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'

volumes:
  prometheus-data:
```

### 2.2 Kubernetes部署

```yaml
# prometheus-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: prometheus
spec:
  replicas: 1
  selector:
    matchLabels:
      app: prometheus
  template:
    metadata:
      labels:
        app: prometheus
    spec:
      containers:
      - name: prometheus
        image: prom/prometheus:latest
        ports:
        - containerPort: 9090
```

---

## 3. Redis Exporter配置

### 3.1 Exporter部署

```bash
# 下载Redis Exporter
wget https://github.com/oliver006/redis_exporter/releases/download/v1.45.0/redis_exporter-v1.45.0.linux-amd64.tar.gz

# 启动Exporter
./redis_exporter -redis.addr=redis://localhost:6379
```

### 3.2 Prometheus配置

```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'redis'
    static_configs:
      - targets: ['redis-exporter:9121']
    metrics_path: /metrics
```

---

## 4. 监控指标采集

### 4.1 关键指标

- `redis_connected_clients`：连接数
- `redis_commands_processed_total`：命令处理总数
- `redis_keyspace_keys`：键数量
- `redis_memory_used_bytes`：内存使用
- `redis_uptime_in_seconds`：运行时间

---

## 5. 告警规则配置

### 5.1 告警规则

```yaml
# alerts.yml
groups:
  - name: redis_alerts
    rules:
      - alert: RedisDown
        expr: redis_up == 0
        for: 1m
        annotations:
          summary: "Redis instance is down"

      - alert: RedisHighMemory
        expr: redis_memory_used_bytes / redis_memory_max_bytes > 0.9
        for: 5m
        annotations:
          summary: "Redis memory usage is high"
```

---

## 6. 扩展阅读

- [Grafana可视化](07.03.02-Grafana可视化.md)
- [告警规则与通知](07.03.03-告警规则与通知.md)
- [缓存监控指标体系](../../04-架构设计/04.04-缓存问题与治理/04.04.07-缓存监控指标体系.md)

---

## 7. 权威参考

- [Prometheus官方文档](https://prometheus.io/docs/)
- [Redis Exporter](https://github.com/oliver006/redis_exporter)

---

**文档版本**：v1.0
**最后更新**：2025-01
**文档状态**：✅ 完成
